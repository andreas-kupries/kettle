[comment {--- !doctools ---}]
[comment { DSL :: kettle doc :: }]

[comment {- - -- --- ----- -------- ------------- ---------------------}]
[call [cmd {kettle doc}] [opt [arg docroot]]]

This command declares the presence of [package doctools]-based
documentation files under the directory [arg docroot], which is a
path relative to the source directory we are in.

[para] If not specified [arg docroot] defaults to [file doc].

[para] If documentation files are found the command will define the
recipe "doc" which, when invoked, will convert the documentation into
HTML and nroff and save the result of that conversion into the
directory specified by [cmd {kettle doc-destination}] (see below) or
[syscmd kettle]'s option [option --doc-destination]. The default for
this is [file embedded].

[para] It will further define the recipes
[list_begin enumerated]
[enum] "install-doc-manpages"
[enum] "install-doc-html"
[enum] "drop-doc-manpages"
[enum] "drop-doc-html"
[list_end]

and extend the recipes "install-doc", "install", "drop-doc", and
"drop".  This enables the package builder to (un)install the
documentation, all, or in part.

[comment { ## TODO ## Describe --html-dir, --man-dir, and defaults }]

[para] The documentation in these recipes is taken from the doc
destination directory in the package sources (see recipe "doc" above).

[para] Now for various important notes, limitations, etc.:

[list_begin enumerated]

[enum]	This command is run for effect only once, even if invoked
	multiple times. First invocation wins.

[enum]	This command is run implicitly by [cmd {kettle tcl}].

[enum]	The previous two items together mean that any non-standard
	settings, be it documentation root or destination must come
	before [cmd {kettle tcl}], if that command is used.

[enum]	Documentation files are recognized by containing any of the
	markers

	[list_begin itemized]
	[item] "[const "[lb]manpage_begin"]"
	[item] "[const "--- doctools ---"]"
	[item] "[const "tcl\.tk//DSL doctools//EN//"]"
	[list_end]

	in their first 1024 characters. Possible documentation files
	containing the [const "[lb]manpage_begin"] marker are rejected
	should they contain any of the anti-markers

	[list_begin itemized]
	[item] "[const "--- !doctools ---"]"
	[item] "[const "!tcl\.tk//DSL doctools//EN//"]"
	[list_end]

	in their first 1024 characters. This last is necessary as
	doctools include file feature allows the actual document
	content to start in an include file which cannot operate
	without being includes from a master file configuring it.

[enum]	The "doc" recipe uses the [syscmd dtplite] application to
	perform the various conversions. It will fail if this
	application cannot be found on the [var PATH].

[enum]	This command calls "[cmd {kettle figures}] [arg docroot]/figures"
	to search for and handle diagrams. Any non-standard settings
	for diagrams must be declared before [cmd {kettle doc}] itself
	is used.

[list_end]

[comment {- - -- --- ----- -------- ------------- ---------------------}]
[call [cmd {kettle doc-destination}] [arg path]]

The "doc" recipe generated by the [cmd {kettle doc}] command above
saves its conversion results by default in the sub-directory
[file embedded] of the package/application source directory.

[para]	This command is for the general adjustment of this default
	destination for the package/application.

[para]	It can also be adjusted on a per-run basis through the option
	[option --doc-destination] of [cmd kettle]

[comment {- - -- --- ----- -------- ------------- ---------------------}]
